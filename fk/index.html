<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>index</title>
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<link rel="stylesheet" type="text/css" href="./Qgis2threejs.css">
<script src="./threejs/three.min.js"></script>
<script src="./threejs/OrbitControls.js"></script>

<script src="./dat-gui/dat.gui.min.js"></script>
<script src="./Qgis2threejs.js"></script>
<script src="./dat-gui_panel.js"></script>
</head>
<body>
<div id="view">
  <div id="labels"></div>
  <div id="northarrow"></div>
</div>
<script>
  var lat = null;
  var long = null;
  var antilat = null;
  var antilong = null;
  var antitz = null;
  var herenow = moment();
  var antiherenow = moment();
  var sunPos;
  var antisunPos;
  var alt = 0.0;
  var azi = 0.0;

  function r2d(radians) {
    var pi = Math.PI;
    return radians * (180 / pi);
  }

  function d2r(degress) {
    var pi = Math.PI;
    return degrees * (pi / 180);
  }

  function round(value, decimals) {
    return Number(Math.round(value + 'e' + decimals) + 'e-' + decimals);
  }


  (function geoSuccess(position) {

    if (!!navigator.geolocation) {

      navigator.geolocation.getCurrentPosition(function(position) {

        lat = round(position.coords.latitude, 3);
        long = round(position.coords.longitude, 3);
        const now = new Date();
        const antinow = new Date();

        // alert("Current position: " + lat + " " + lng);
        document.getElementById("loc").innerHTML = "Current position: " + lat + ", " + long;
        document.getElementById("date").innerHTML = "Date/Time: " + now;

        setTimeout(geoSuccess, 3000);
        antilat = lat * -1;
        antilong = 180 - Math.abs(long);
        if (Math.sign(long) == 1) antilong = antilong * -1;

        //if (Math.sign(long)==-1) antilong=parseFloat(antilong)*-1;

        document.getElementById("antiloc").innerHTML = "Antipode position: " + antilat + ", " + antilong;

        // get today's sunlight times for London
        var times = SunCalc.getTimes(antinow, antilat, antilong);
        //console.log(times);

        // format sunrise time from the Date object
        var sunriseStr = times.sunrise.getHours() + ':' + times.sunrise.getMinutes();

        // var apiUrl = 'https://secure.geonames.org/timezoneJSON?lat=-4.622&lng=30.927&username=grundum';
        var apiUrl = 'https://secure.geonames.org/timezoneJSON?lat=' + antilat + '&lng=' + antilong + '&username=grundum';
        fetch(apiUrl).then(response => {
          return response.json();
        }).then(data => {
          // Work with JSON data here
          //console.log(data);
          antitz = data.timezoneId;

          herenow = moment();
          //console.log(herenow);

          antiherenow = herenow.tz(antitz);
          //antiherenow=antiherenow.format("ddd MMMM DD YYYY HH:mm:ss [GMT]Z");                               

          // get position of the sun (azimuth and altitude) now
          sunPos = SunCalc.getPosition(herenow, position.coords.latitude, position.coords.longitude);
          //console.log(sunPos);

          // get position of the antipode sun (azimuth and altitude) now
          antisunPos = SunCalc.getPosition(antiherenow, antilat, antilong);
          //console.log(antisunPos);

          alt = antisunPos.altitude;
          azi = antisunPos.azimuth;


          document.getElementById("sunpos").innerHTML = "Sun position: Azimuth: " + r2d(sunPos.azimuth + 3.141516) + " / " + (sunPos.azimuth + 3.141516) + " - Elevation:" + r2d(sunPos.altitude) + " / " + sunPos.altitude;


          document.getElementById("antisunpos").innerHTML = "Antipode sun position: Azimuth: " + r2d(antisunPos.azimuth + 3.141516) + " / " + (antisunPos.azimuth + 3.141516) + "  - Elevation:" + r2d(antisunPos.altitude) + " / " + antisunPos.altitude;
          document.getElementById("antidate").innerHTML = "Date/Time: " + antiherenow.format("ddd MMMM DD YYYY HH:mm:ss [GMT]Z") + " (" + antitz + ")";

          guiChanged();

        }).catch(err => {
          // Do something for an error here
        });
      });

    } else {
      //document.getElementById('lat').innerHTML = 'No Geolocation Support.';
    }

  })();



  if (WEBGL.isWebGLAvailable() === false) {

    document.body.appendChild(WEBGL.getWebGLErrorMessage());


  }

<!-- popup -->
<div id="popup">
  <div id="closebtn">&times;</div>
  <div id="popupbar"></div>
  <div id="popupbody">
    <div id="popupcontent"></div>

    <!-- query result -->
    <div id="queryresult">
      <table id="qr_layername_table">
        <caption>Layer name</caption>
        <tr><td id="qr_layername"></td></tr>
      </table>

      <table id="qr_coords_table">
        <caption>Clicked coordinates</caption>
        <tr><td id="qr_coords"></td></tr>
      </table>

      <!-- camera actions -->
      <div class="action-btn action-zoom" onclick="app.cameraAction.zoomIn(); app.closePopup();">Zoom in here</div>
      <div class="action-btn action-move" onclick="app.cameraAction.move(); app.closePopup();">Move here</div>
      <div class="action-btn action-orbit" onclick="app.cameraAction.orbit(); app.closePopup();">Orbit around here</div>

      <!-- attributes -->
      <table id="qr_attrs_table">
        <caption>Attributes</caption>
      </table>
    </div>

    <!-- page info -->
    <div id="pageinfo">
      <h1>Current View URL</h1>
      <div><input id="urlbox" type="text"></div>

      <h1>Usage</h1>
      <table id="usage">
        <tr><td colspan="2" class="star">Mouse</td></tr>
        <tr><td>Left button + Move</td><td>Orbit</td></tr>
        <tr><td>Mouse Wheel</td><td>Zoom</td></tr>
        <tr><td>Right button + Move</td><td>Pan</td></tr>

        <tr><td colspan="2" class="star">Keys</td></tr>
        <tr><td>Arrow keys</td><td>Move Horizontally</td></tr>
        <tr><td>Shift + Arrow keys</td><td>Orbit</td></tr>
        <tr><td>Ctrl + Arrow keys</td><td>Rotate</td></tr>
        <tr><td>Shift + Ctrl + Up / Down</td><td>Zoom In / Out</td></tr>
        <tr><td>L</td><td>Toggle Label Visibility</td></tr>
        <tr><td>R</td><td>Start / Stop Rotate Animation (Orbiting)</td></tr>
        <tr><td>W</td><td>Wireframe Mode</td></tr>
        <tr><td>Shift + R</td><td>Reset Camera Position</td></tr>
        <tr><td>Shift + S</td><td>Save Image</td></tr>
      </table>

      <h1>About</h1>
      <div id="about">
        This page was made with <a href="https://www.qgis.org/" target="_blank">QGIS</a> and <a href="https://github.com/minorua/Qgis2threejs" target="_blank">Qgis2threejs</a> plugin.
        Dependent JavaScript libraries are
        <a href="https://threejs.org/" target="_blank">three.js</a>, 
        <a href="https://code.google.com/p/dat-gui/" target="_blank">dat-gui</a>
        <span id="lib_proj4js"> and <a href="https://trac.osgeo.org/proj4js/" target="_blank">Proj4js</a></span>
        .
      </div>
    </div>
  </div>
</div>

<!-- progress bar -->
<div id="progress"><div id="bar"></div></div>

<!-- header and footer -->
<div id="header"></div>
<div id="footer"></div>

<script>
Q3D.Config.northArrow.visible = true;
Q3D.Config.northArrow.color = 0xfafafa;
if (typeof proj4 === "undefined") document.getElementById("lib_proj4js").style.display = "none";

var app = Q3D.application,
    container = document.getElementById("view");

app.init(container);      // initialize application

// when all relevant files have been loaded into the scene
app.addEventListener("sceneLoaded", function () {
  // set custom plane z range
  var box = new THREE.Box3().setFromObject(app.scene),
      zMin = app.scene.toMapCoordinates(0, 0, box.min.y).z,
      zMax = app.scene.toMapCoordinates(0, 0, box.max.y).z;
  Q3D.gui.initCustomPlaneFolder(zMin, zMax);
});

// load the scene
app.loadSceneFile("./data/index/scene.json", function () {
  app.start();

  Q3D.gui.init();   // initialize dat-gui panel

  // North arrow inset
  if (Q3D.Config.northArrow.visible) app.buildNorthArrow(document.getElementById("northarrow"), app.scene.userData.rotation);
});
</script>
</body>
</html>
